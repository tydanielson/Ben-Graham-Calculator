'use strict';

(function(){
	angular.module('wsi')
		.controller('MainCtrl', function($scope, $http, $q, $firebaseAuth, $firebaseObject, $timeout, CalculationService){

		$scope.user = {};
		$scope.ben = {};
		//$scope.history = [];

		$scope.loggedIn = false;

		if ($scope.user.email !== undefined) {
			$scope.loggedIn = true;
		}

		var auth = $firebaseAuth();
		var provider = new firebase.auth.GoogleAuthProvider();
		//var array = $firebaseArray();

		firebase.auth().onAuthStateChanged(function(user) {
		  if (user) {
		      $scope.loggedIn = true;
		      //var userId = firebase.auth().currentUser.uid;
		      var ref = firebase.database().ref("/users/" + user.uid);
			  $scope.user = $firebaseObject(ref);

			  $scope.$apply();
		  }
		});

		$scope.googleAuth = function () {
			firebase.auth().signInWithPopup(provider).then(function(result) {
			  // This gives you a Google Access Token. You can use it to access the Google API.
			  var token = result.credential.accessToken;
			  // The signed-in user info.
			  var user = result.user;
			  var ref = firebase.database().ref("/users/" + user.uid);
			  $scope.user = $firebaseObject(ref);
			  $scope.user.name = user.displayName;
			  $scope.user.$save();

			  $scope.loggedIn = true;

			  $scope.$apply();

			}).catch(function(error) {
			  // Handle Errors here.
			  var errorCode = error.code;
			  var errorMessage = error.message;
			  // The email of the user's account used.
			  var email = error.email;
			  // The firebase.auth.AuthCredential type that was used.
			  var credential = error.credential;
			  // ...
			});
		}

		$scope.logout = function () {
			firebase.auth().signOut().then(function() {
			  $scope.loggedIn = false;
			}, function(error) {
			  // An error happened.
			});
		};

		$scope.ratios = {};
		$scope.quote = {};


		//revenue over 500 million = one point


		$scope.getCompanyData = function() {
			//clear out the existing values
			$scope.ratios = {};
			$scope.quote = {};
			var qpromise = $scope.getStockQuote();
			var rpromise = $scope.getRatios();

			$q.all([
					qpromise, 
					rpromise
				])
				.then(function(data) {
					var tpromise = CalculationService.calculatepts($scope.ratios, $scope.quote);
					tpromise.then(function(data){
						$scope.totalpts = data.totalpts;
						$scope.outOfPts = data.outOfPts;
						$scope.stockData = data.stockData;
						if ($scope.user.history === undefined) {
							$scope.user.history = [];
						}
						$scope.user.history.unshift({"company" : $scope.quote.Name, "score" : data.totalpts, "outOfScore" : data.outOfPts});
						if ($scope.user.history.length >= 6) {
							$scope.user.history.pop();
						}
						$scope.user.$save();
					});
				});
		}; 

		$scope.getStockQuote = function() {
			var defer = $q.defer();

			$http.get('/stock/quote/' + $scope.ben.ticker)
				.then(function(res){
					//console.log(res.data);
					if (res.data.quote === null) {
						var url = 'https://services.last10k.com/v1/company/' + $scope.ben.ticker + '/quote'
						$http.get(url)			
							.then(function(data){
								//console.log("quote", data);
								$scope.quote = data.data;
								$scope.quote.priceToBook = $scope.quote.LastTradePrice/$scope.quote.BookValue;
								//$scope.previousLookups.push({"company" : $scope.quote.Name, "score" : $scope.points});
								$http({
									url: '/stock/quote/' + $scope.ben.ticker, 
									data: {"quote": $scope.quote},
									method: "POST",
									headers: {
										'Content-Type': 'application/json'
									}});

								defer.resolve();
							}, function(data){
								def.reject("Failed to get quote");
								alert('Please wait... too many API calls.');
							});
					} else {
						$scope.quote = JSON.parse(res.data.quote);
						defer.resolve();
					}
				});

			return defer.promise;
		};

		$scope.getRatios = function() {
			var defer = $q.defer();
			$http.get('/stock/ratio/' + $scope.ben.ticker)
				.then(function(res){
					if(res.data.stock === null){
						var url = 'https://services.last10k.com/v1/company/' + $scope.ben.ticker + '/ratios'
						$http.get(url)			
							.then(function (data) {
								//console.debug("ratios", data);
								var ratios = $scope.setRatioData(data);
								$scope.saveRatioData($scope.ben.ticker, ratios);
								defer.resolve();

							}, function(data){
								alert('Please wait... too many API calls.');
								def.reject("Failed to get ratios");
							});
						
					} else {
						//set the ratio data here
						$scope.ratios = JSON.parse(res.data.stock);
						defer.resolve();
					}
			});
			return defer.promise;
		};

		window.vrefresh = function () {
			//foreach ticker get the ratios and the stock and save to cache system
			var tickerArr = [{"Symbol":"MMM","Name":"3M Company","Sector":"Industrials"},{"Symbol":"ABT","Name":"Abbott Laboratories","Sector":"Health Care"},{"Symbol":"ABBV","Name":"AbbVie","Sector":"Health Care"},{"Symbol":"ACN","Name":"Accenture plc","Sector":"Information Technology"},{"Symbol":"ATVI","Name":"Activision Blizzard","Sector":"Information Technology"},{"Symbol":"AYI","Name":"Acuity Brands Inc","Sector":"Industrials"},{"Symbol":"ADBE","Name":"Adobe Systems Inc","Sector":"Information Technology"},{"Symbol":"AAP","Name":"Advance Auto Parts","Sector":"Consumer Discretionary"},{"Symbol":"AES","Name":"AES Corp","Sector":"Utilities"},{"Symbol":"AET","Name":"Aetna Inc","Sector":"Health Care"},{"Symbol":"AMG","Name":"Affiliated Managers Group Inc","Sector":"Financials"},{"Symbol":"AFL","Name":"AFLAC Inc","Sector":"Financials"},{"Symbol":"A","Name":"Agilent Technologies Inc","Sector":"Health Care"},{"Symbol":"APD","Name":"Air Products & Chemicals Inc","Sector":"Materials"},{"Symbol":"AKAM","Name":"Akamai Technologies Inc","Sector":"Information Technology"},{"Symbol":"ALK","Name":"Alaska Air Group Inc","Sector":"Industrials"},{"Symbol":"ALB","Name":"Albemarle Corp","Sector":"Materials"},{"Symbol":"AA","Name":"Alcoa Inc","Sector":"Materials"},{"Symbol":"ALXN","Name":"Alexion Pharmaceuticals","Sector":"Health Care"},{"Symbol":"ALLE","Name":"Allegion","Sector":"Industrials"},{"Symbol":"AGN","Name":"Allergan plc","Sector":"Health Care"},{"Symbol":"ADS","Name":"Alliance Data Systems","Sector":"Information Technology"},{"Symbol":"LNT","Name":"Alliant Energy Corp","Sector":"Utilities"},{"Symbol":"ALL","Name":"Allstate Corp","Sector":"Financials"},{"Symbol":"GOOGL","Name":"Alphabet Inc Class A","Sector":"Information Technology"},{"Symbol":"GOOG","Name":"Alphabet Inc Class C","Sector":"Information Technology"},{"Symbol":"MO","Name":"Altria Group Inc","Sector":"Consumer Staples"},{"Symbol":"AMZN","Name":"Amazon.com Inc","Sector":"Consumer Discretionary"},{"Symbol":"AEE","Name":"Ameren Corp","Sector":"Utilities"},{"Symbol":"AAL","Name":"American Airlines Group","Sector":"Industrials"},{"Symbol":"AEP","Name":"American Electric Power","Sector":"Utilities"},{"Symbol":"AXP","Name":"American Express Co","Sector":"Financials"},{"Symbol":"AIG","Name":"American International Group, Inc.","Sector":"Financials"},{"Symbol":"AMT","Name":"American Tower Corp A","Sector":"Financials"},{"Symbol":"AWK","Name":"American Water Works Company Inc","Sector":"Utilities"},{"Symbol":"AMP","Name":"Ameriprise Financial","Sector":"Financials"},{"Symbol":"ABC","Name":"AmerisourceBergen Corp","Sector":"Health Care"},{"Symbol":"AME","Name":"Ametek","Sector":"Industrials"},{"Symbol":"AMGN","Name":"Amgen Inc","Sector":"Health Care"},{"Symbol":"APH","Name":"Amphenol Corp A","Sector":"Industrials"},{"Symbol":"APC","Name":"Anadarko Petroleum Corp","Sector":"Energy"},{"Symbol":"ADI","Name":"Analog Devices, Inc.","Sector":"Information Technology"},{"Symbol":"ANTM","Name":"Anthem Inc.","Sector":"Health Care"},{"Symbol":"AON","Name":"Aon plc","Sector":"Financials"},{"Symbol":"APA","Name":"Apache Corporation","Sector":"Energy"},{"Symbol":"AIV","Name":"Apartment Investment & Mgmt","Sector":"Financials"},{"Symbol":"AAPL","Name":"Apple Inc.","Sector":"Information Technology"},{"Symbol":"AMAT","Name":"Applied Materials Inc","Sector":"Information Technology"},{"Symbol":"ADM","Name":"Archer-Daniels-Midland Co","Sector":"Consumer Staples"},{"Symbol":"AJG","Name":"Arthur J. Gallagher & Co.","Sector":"Financials"},{"Symbol":"AIZ","Name":"Assurant Inc","Sector":"Financials"},{"Symbol":"T","Name":"AT&T Inc","Sector":"Telecommunications Services"},{"Symbol":"ADSK","Name":"Autodesk Inc","Sector":"Information Technology"},{"Symbol":"ADP","Name":"Automatic Data Processing","Sector":"Information Technology"},{"Symbol":"AN","Name":"AutoNation Inc","Sector":"Consumer Discretionary"},{"Symbol":"AZO","Name":"AutoZone Inc","Sector":"Consumer Discretionary"},{"Symbol":"AVGO","Name":"Avago Technologies","Sector":"Information Technology"},{"Symbol":"AVB","Name":"AvalonBay Communities, Inc.","Sector":"Financials"},{"Symbol":"AVY","Name":"Avery Dennison Corp","Sector":"Materials"},{"Symbol":"BHI","Name":"Baker Hughes Inc","Sector":"Energy"},{"Symbol":"BLL","Name":"Ball Corp","Sector":"Materials"},{"Symbol":"BAC","Name":"Bank of America Corp","Sector":"Financials"},{"Symbol":"BCR","Name":"Bard (C.R.) Inc.","Sector":"Health Care"},{"Symbol":"BAX","Name":"Baxter International Inc.","Sector":"Health Care"},{"Symbol":"BBT","Name":"BB&T Corporation","Sector":"Financials"},{"Symbol":"BDX","Name":"Becton Dickinson","Sector":"Health Care"},{"Symbol":"BBBY","Name":"Bed Bath & Beyond","Sector":"Consumer Discretionary"},{"Symbol":"BRK-B","Name":"Berkshire Hathaway","Sector":"Financials"},{"Symbol":"BBY","Name":"Best Buy Co. Inc.","Sector":"Consumer Discretionary"},{"Symbol":"BIIB","Name":"BIOGEN IDEC Inc.","Sector":"Health Care"},{"Symbol":"BLK","Name":"BlackRock","Sector":"Financials"},{"Symbol":"HRB","Name":"Block H&R","Sector":"Financials"},{"Symbol":"BA","Name":"Boeing Company","Sector":"Industrials"},{"Symbol":"BWA","Name":"BorgWarner","Sector":"Consumer Discretionary"},{"Symbol":"BXP","Name":"Boston Properties","Sector":"Financials"},{"Symbol":"BSX","Name":"Boston Scientific","Sector":"Health Care"},{"Symbol":"BMY","Name":"Bristol-Myers Squibb","Sector":"Health Care"},{"Symbol":"BF-B","Name":"Brown-Forman Corporation","Sector":"Consumer Staples"},{"Symbol":"CHRW","Name":"C. H. Robinson Worldwide","Sector":"Industrials"},{"Symbol":"CA","Name":"CA, Inc.","Sector":"Information Technology"},{"Symbol":"COG","Name":"Cabot Oil & Gas","Sector":"Energy"},{"Symbol":"CPB","Name":"Campbell Soup","Sector":"Consumer Staples"},{"Symbol":"COF","Name":"Capital One Financial","Sector":"Financials"},{"Symbol":"CAH","Name":"Cardinal Health Inc.","Sector":"Health Care"},{"Symbol":"KMX","Name":"Carmax Inc","Sector":"Consumer Discretionary"},{"Symbol":"CCL","Name":"Carnival Corp.","Sector":"Consumer Discretionary"},{"Symbol":"CAT","Name":"Caterpillar Inc.","Sector":"Industrials"},{"Symbol":"CBG","Name":"CBRE Group","Sector":"Financials"},{"Symbol":"CBS","Name":"CBS Corp.","Sector":"Consumer Discretionary"},{"Symbol":"CELG","Name":"Celgene Corp.","Sector":"Health Care"},{"Symbol":"CNC","Name":"Centene Corporation","Sector":"Health Care"},{"Symbol":"CNP","Name":"CenterPoint Energy","Sector":"Utilities"},{"Symbol":"CTL","Name":"CenturyLink Inc","Sector":"Telecommunications Services"},{"Symbol":"CERN","Name":"Cerner","Sector":"Health Care"},{"Symbol":"CF","Name":"CF Industries Holdings Inc","Sector":"Materials"},{"Symbol":"SCHW","Name":"Charles Schwab Corporation","Sector":"Financials"},{"Symbol":"CHK","Name":"Chesapeake Energy","Sector":"Energy"},{"Symbol":"CVX","Name":"Chevron Corp.","Sector":"Energy"},{"Symbol":"CMG","Name":"Chipotle Mexican Grill","Sector":"Consumer Discretionary"},{"Symbol":"CB","Name":"Chubb Limited","Sector":"Financials"},{"Symbol":"CHD","Name":"Church & Dwight","Sector":"Consumer Staples"},{"Symbol":"CI","Name":"CIGNA Corp.","Sector":"Health Care"},{"Symbol":"XEC","Name":"Cimarex Energy","Sector":"Energy"},{"Symbol":"CINF","Name":"Cincinnati Financial","Sector":"Financials"},{"Symbol":"CTAS","Name":"Cintas Corporation","Sector":"Industrials"},{"Symbol":"CSCO","Name":"Cisco Systems","Sector":"Information Technology"},{"Symbol":"C","Name":"Citigroup Inc.","Sector":"Financials"},{"Symbol":"CFG","Name":"Citizens Financial Group","Sector":"Financials"},{"Symbol":"CTXS","Name":"Citrix Systems","Sector":"Information Technology"},{"Symbol":"CME","Name":"CME Group Inc.","Sector":"Financials"},{"Symbol":"CMS","Name":"CMS Energy","Sector":"Utilities"},{"Symbol":"COH","Name":"Coach Inc.","Sector":"Consumer Discretionary"},{"Symbol":"CTSH","Name":"Cognizant Technology Solutions","Sector":"Information Technology"},{"Symbol":"CL","Name":"Colgate-Palmolive","Sector":"Consumer Staples"},{"Symbol":"CMCSA","Name":"Comcast A Corp","Sector":"Consumer Discretionary"},{"Symbol":"CMA","Name":"Comerica Inc.","Sector":"Financials"},{"Symbol":"CAG","Name":"ConAgra Foods Inc.","Sector":"Consumer Staples"},{"Symbol":"CXO","Name":"Concho Resources","Sector":"Energy"},{"Symbol":"COP","Name":"ConocoPhillips","Sector":"Energy"},{"Symbol":"ED","Name":"Consolidated Edison","Sector":"Utilities"},{"Symbol":"STZ","Name":"Constellation Brands","Sector":"Consumer Staples"},{"Symbol":"GLW","Name":"Corning Inc.","Sector":"Industrials"},{"Symbol":"COST","Name":"Costco Co.","Sector":"Consumer Staples"},{"Symbol":"CCI","Name":"Crown Castle International Corp.","Sector":"Financials"},{"Symbol":"CSRA","Name":"CSRA Inc.","Sector":"Information Technology"},{"Symbol":"CSX","Name":"CSX Corp.","Sector":"Industrials"},{"Symbol":"CMI","Name":"Cummins Inc.","Sector":"Industrials"},{"Symbol":"CVS","Name":"CVS Health","Sector":"Consumer Staples"},{"Symbol":"DHI","Name":"D. R. Horton","Sector":"Consumer Discretionary"},{"Symbol":"DHR","Name":"Danaher Corp.","Sector":"Industrials"},{"Symbol":"DRI","Name":"Darden Restaurants","Sector":"Consumer Discretionary"},{"Symbol":"DVA","Name":"DaVita Inc.","Sector":"Health Care"},{"Symbol":"DE","Name":"Deere & Co.","Sector":"Industrials"},{"Symbol":"DLPH","Name":"Delphi Automotive","Sector":"Consumer Discretionary"},{"Symbol":"DAL","Name":"Delta Air Lines","Sector":"Industrials"},{"Symbol":"XRAY","Name":"Dentsply Sirona","Sector":"Health Care"},{"Symbol":"DVN","Name":"Devon Energy Corp.","Sector":"Energy"},{"Symbol":"DO","Name":"Diamond Offshore Drilling","Sector":"Energy"},{"Symbol":"DLR","Name":"Digital Realty Trust","Sector":"Financials"},{"Symbol":"DFS","Name":"Discover Financial Services","Sector":"Financials"},{"Symbol":"DISCA","Name":"Discovery Communications-A","Sector":"Consumer Discretionary"},{"Symbol":"DISCK","Name":"Discovery Communications-C","Sector":"Consumer Discretionary"},{"Symbol":"DG","Name":"Dollar General","Sector":"Consumer Discretionary"},{"Symbol":"DLTR","Name":"Dollar Tree","Sector":"Consumer Discretionary"},{"Symbol":"D","Name":"Dominion Resources","Sector":"Utilities"},{"Symbol":"DOV","Name":"Dover Corp.","Sector":"Industrials"},{"Symbol":"DOW","Name":"Dow Chemical","Sector":"Materials"},{"Symbol":"DPS","Name":"Dr Pepper Snapple Group","Sector":"Consumer Staples"},{"Symbol":"DTE","Name":"DTE Energy Co.","Sector":"Utilities"},{"Symbol":"DD","Name":"Du Pont (E.I.)","Sector":"Materials"},{"Symbol":"DUK","Name":"Duke Energy","Sector":"Utilities"},{"Symbol":"DNB","Name":"Dun & Bradstreet","Sector":"Industrials"},{"Symbol":"ETFC","Name":"E*Trade","Sector":"Financials"},{"Symbol":"EMN","Name":"Eastman Chemical","Sector":"Materials"},{"Symbol":"ETN","Name":"Eaton Corporation","Sector":"Industrials"},{"Symbol":"EBAY","Name":"eBay Inc.","Sector":"Information Technology"},{"Symbol":"ECL","Name":"Ecolab Inc.","Sector":"Materials"},{"Symbol":"EIX","Name":"Edison Int'l","Sector":"Utilities"},{"Symbol":"EW","Name":"Edwards Lifesciences","Sector":"Health Care"},{"Symbol":"EA","Name":"Electronic Arts","Sector":"Information Technology"},{"Symbol":"EMC","Name":"EMC Corp.","Sector":"Information Technology"},{"Symbol":"EMR","Name":"Emerson Electric Company","Sector":"Industrials"},{"Symbol":"ENDP","Name":"Endo International","Sector":"Health Care"},{"Symbol":"ETR","Name":"Entergy Corp.","Sector":"Utilities"},{"Symbol":"EOG","Name":"EOG Resources","Sector":"Energy"},{"Symbol":"EQT","Name":"EQT Corporation","Sector":"Energy"},{"Symbol":"EFX","Name":"Equifax Inc.","Sector":"Financials"},{"Symbol":"EQIX","Name":"Equinix","Sector":"Information Technology"},{"Symbol":"EQR","Name":"Equity Residential","Sector":"Financials"},{"Symbol":"ESS","Name":"Essex Property Trust Inc","Sector":"Financials"},{"Symbol":"EL","Name":"Estee Lauder Cos.","Sector":"Consumer Staples"},{"Symbol":"ES","Name":"Eversource Energy","Sector":"Utilities"},{"Symbol":"EXC","Name":"Exelon Corp.","Sector":"Utilities"},{"Symbol":"EXPE","Name":"Expedia Inc.","Sector":"Consumer Discretionary"},{"Symbol":"EXPD","Name":"Expeditors Int'l","Sector":"Industrials"},{"Symbol":"ESRX","Name":"Express Scripts","Sector":"Health Care"},{"Symbol":"EXR","Name":"Extra Space Storage","Sector":"Financials"},{"Symbol":"XOM","Name":"Exxon Mobil Corp.","Sector":"Energy"},{"Symbol":"FFIV","Name":"F5 Networks","Sector":"Information Technology"},{"Symbol":"FB","Name":"Facebook","Sector":"Information Technology"},{"Symbol":"FAST","Name":"Fastenal Co","Sector":"Industrials"},{"Symbol":"FRT","Name":"Federal Realty Investment Trust","Sector":"Financials"},{"Symbol":"FDX","Name":"FedEx Corporation","Sector":"Industrials"},{"Symbol":"FIS","Name":"Fidelity National Information Services","Sector":"Information Technology"},{"Symbol":"FITB","Name":"Fifth Third Bancorp","Sector":"Financials"},{"Symbol":"FSLR","Name":"First Solar Inc","Sector":"Information Technology"},{"Symbol":"FE","Name":"FirstEnergy Corp","Sector":"Utilities"},{"Symbol":"FISV","Name":"Fiserv Inc","Sector":"Information Technology"},{"Symbol":"FLIR","Name":"FLIR Systems","Sector":"Industrials"},{"Symbol":"FLS","Name":"Flowserve Corporation","Sector":"Industrials"},{"Symbol":"FLR","Name":"Fluor Corp.","Sector":"Industrials"},{"Symbol":"FMC","Name":"FMC Corporation","Sector":"Materials"},{"Symbol":"FTI","Name":"FMC Technologies Inc.","Sector":"Energy"},{"Symbol":"FL","Name":"Foot Locker Inc","Sector":"Consumer Discretionary"},{"Symbol":"F","Name":"Ford Motor","Sector":"Consumer Discretionary"},{"Symbol":"FTV","Name":"Fortive Corp","Sector":"Industrials"},{"Symbol":"FBHS","Name":"Fortune Brands Home & Security","Sector":"Industrials"},{"Symbol":"BEN","Name":"Franklin Resources","Sector":"Financials"},{"Symbol":"FCX","Name":"Freeport-McMoran Cp & Gld","Sector":"Materials"},{"Symbol":"FTR","Name":"Frontier Communications","Sector":"Telecommunications Services"},{"Symbol":"GPS","Name":"Gap (The)","Sector":"Consumer Discretionary"},{"Symbol":"GRMN","Name":"Garmin Ltd.","Sector":"Consumer Discretionary"},{"Symbol":"GD","Name":"General Dynamics","Sector":"Industrials"},{"Symbol":"GE","Name":"General Electric","Sector":"Industrials"},{"Symbol":"GGP","Name":"General Growth Properties Inc.","Sector":"Financials"},{"Symbol":"GIS","Name":"General Mills","Sector":"Consumer Staples"},{"Symbol":"GM","Name":"General Motors","Sector":"Consumer Discretionary"},{"Symbol":"GPC","Name":"Genuine Parts","Sector":"Consumer Discretionary"},{"Symbol":"GILD","Name":"Gilead Sciences","Sector":"Health Care"},{"Symbol":"GPN","Name":"Global Payments Inc","Sector":"Information Technology"},{"Symbol":"GS","Name":"Goldman Sachs Group","Sector":"Financials"},{"Symbol":"GT","Name":"Goodyear Tire & Rubber","Sector":"Consumer Discretionary"},{"Symbol":"GWW","Name":"Grainger (W.W.) Inc.","Sector":"Industrials"},{"Symbol":"HAL","Name":"Halliburton Co.","Sector":"Energy"},{"Symbol":"HBI","Name":"Hanesbrands Inc","Sector":"Consumer Discretionary"},{"Symbol":"HOG","Name":"Harley-Davidson","Sector":"Consumer Discretionary"},{"Symbol":"HAR","Name":"Harman Int'l Industries","Sector":"Consumer Discretionary"},{"Symbol":"HRS","Name":"Harris Corporation","Sector":"Information Technology"},{"Symbol":"HIG","Name":"Hartford Financial Svc.Gp.","Sector":"Financials"},{"Symbol":"HAS","Name":"Hasbro Inc.","Sector":"Consumer Discretionary"},{"Symbol":"HCA","Name":"HCA Holdings","Sector":"Health Care"},{"Symbol":"HCP","Name":"HCP Inc.","Sector":"Financials"},{"Symbol":"HP","Name":"Helmerich & Payne","Sector":"Energy"},{"Symbol":"HSIC","Name":"Henry Schein","Sector":"Health Care"},{"Symbol":"HES","Name":"Hess Corporation","Sector":"Energy"},{"Symbol":"HPE","Name":"Hewlett Packard Enterprise","Sector":"Information Technology"},{"Symbol":"HOLX","Name":"Hologic","Sector":"Health Care"},{"Symbol":"HD","Name":"Home Depot","Sector":"Consumer Discretionary"},{"Symbol":"HON","Name":"Honeywell Int'l Inc.","Sector":"Industrials"},{"Symbol":"HRL","Name":"Hormel Foods Corp.","Sector":"Consumer Staples"},{"Symbol":"HST","Name":"Host Hotels & Resorts","Sector":"Financials"},{"Symbol":"HPQ","Name":"HP Inc.","Sector":"Information Technology"},{"Symbol":"HUM","Name":"Humana Inc.","Sector":"Health Care"},{"Symbol":"HBAN","Name":"Huntington Bancshares","Sector":"Financials"},{"Symbol":"ITW","Name":"Illinois Tool Works","Sector":"Industrials"},{"Symbol":"ILMN","Name":"Illumina Inc","Sector":"Health Care"},{"Symbol":"IR","Name":"Ingersoll-Rand PLC","Sector":"Industrials"},{"Symbol":"INTC","Name":"Intel Corp.","Sector":"Information Technology"},{"Symbol":"ICE","Name":"Intercontinental Exchange","Sector":"Financials"},{"Symbol":"IBM","Name":"International Bus. Machines","Sector":"Information Technology"},{"Symbol":"IP","Name":"International Paper","Sector":"Materials"},{"Symbol":"IPG","Name":"Interpublic Group","Sector":"Consumer Discretionary"},{"Symbol":"IFF","Name":"Intl Flavors & Fragrances","Sector":"Materials"},{"Symbol":"INTU","Name":"Intuit Inc.","Sector":"Information Technology"},{"Symbol":"ISRG","Name":"Intuitive Surgical Inc.","Sector":"Health Care"},{"Symbol":"IVZ","Name":"Invesco Ltd.","Sector":"Financials"},{"Symbol":"IRM","Name":"Iron Mountain Incorporated","Sector":"Industrials"},{"Symbol":"JBHT","Name":"J. B. Hunt Transport Services","Sector":"Industrials"},{"Symbol":"JEC","Name":"Jacobs Engineering Group","Sector":"Industrials"},{"Symbol":"JNJ","Name":"Johnson & Johnson","Sector":"Health Care"},{"Symbol":"JCI","Name":"Johnson Controls","Sector":"Consumer Discretionary"},{"Symbol":"JPM","Name":"JPMorgan Chase & Co.","Sector":"Financials"},{"Symbol":"JNPR","Name":"Juniper Networks","Sector":"Information Technology"},{"Symbol":"KSU","Name":"Kansas City Southern","Sector":"Industrials"},{"Symbol":"K","Name":"Kellogg Co.","Sector":"Consumer Staples"},{"Symbol":"KEY","Name":"KeyCorp","Sector":"Financials"},{"Symbol":"KMB","Name":"Kimberly-Clark","Sector":"Consumer Staples"},{"Symbol":"KIM","Name":"Kimco Realty","Sector":"Financials"},{"Symbol":"KMI","Name":"Kinder Morgan","Sector":"Energy"},{"Symbol":"KLAC","Name":"KLA-Tencor Corp.","Sector":"Information Technology"},{"Symbol":"KSS","Name":"Kohl's Corp.","Sector":"Consumer Discretionary"},{"Symbol":"KHC","Name":"Kraft Heinz Co","Sector":"Consumer Staples"},{"Symbol":"KR","Name":"Kroger Co.","Sector":"Consumer Staples"},{"Symbol":"LB","Name":"L Brands Inc.","Sector":"Consumer Discretionary"},{"Symbol":"LLL","Name":"L-3 Communications Holdings","Sector":"Industrials"},{"Symbol":"LH","Name":"Laboratory Corp. of America Holding","Sector":"Health Care"},{"Symbol":"LRCX","Name":"Lam Research","Sector":"Information Technology"},{"Symbol":"LM","Name":"Legg Mason","Sector":"Financials"},{"Symbol":"LEG","Name":"Leggett & Platt","Sector":"Industrials"},{"Symbol":"LEN","Name":"Lennar Corp.","Sector":"Consumer Discretionary"},{"Symbol":"LUK","Name":"Leucadia National Corp.","Sector":"Financials"},{"Symbol":"LVLT","Name":"Level 3 Communications","Sector":"Telecommunications Services"},{"Symbol":"LLY","Name":"Lilly (Eli) & Co.","Sector":"Health Care"},{"Symbol":"LNC","Name":"Lincoln National","Sector":"Financials"},{"Symbol":"LLTC","Name":"Linear Technology Corp.","Sector":"Information Technology"},{"Symbol":"LKQ","Name":"LKQ Corporation","Sector":"Consumer Discretionary"},{"Symbol":"LMT","Name":"Lockheed Martin Corp.","Sector":"Industrials"},{"Symbol":"L","Name":"Loews Corp.","Sector":"Financials"},{"Symbol":"LOW","Name":"Lowe's Cos.","Sector":"Consumer Discretionary"},{"Symbol":"LYB","Name":"LyondellBasell","Sector":"Materials"},{"Symbol":"MTB","Name":"M&T Bank Corp.","Sector":"Financials"},{"Symbol":"MAC","Name":"Macerich","Sector":"Financials"},{"Symbol":"M","Name":"Macy's Inc.","Sector":"Consumer Discretionary"},{"Symbol":"MNK","Name":"Mallinckrodt Plc","Sector":"Health Care"},{"Symbol":"MRO","Name":"Marathon Oil Corp.","Sector":"Energy"},{"Symbol":"MPC","Name":"Marathon Petroleum","Sector":"Energy"},{"Symbol":"MAR","Name":"Marriott Int'l.","Sector":"Consumer Discretionary"},{"Symbol":"MMC","Name":"Marsh & McLennan","Sector":"Financials"},{"Symbol":"MLM","Name":"Martin Marietta Materials","Sector":"Materials"},{"Symbol":"MAS","Name":"Masco Corp.","Sector":"Industrials"},{"Symbol":"MA","Name":"Mastercard Inc.","Sector":"Information Technology"},{"Symbol":"MAT","Name":"Mattel Inc.","Sector":"Consumer Discretionary"},{"Symbol":"MKC","Name":"McCormick & Co.","Sector":"Consumer Staples"},{"Symbol":"MCD","Name":"McDonald's Corp.","Sector":"Consumer Discretionary"},{"Symbol":"MCK","Name":"McKesson Corp.","Sector":"Health Care"},{"Symbol":"MJN","Name":"Mead Johnson","Sector":"Consumer Staples"},{"Symbol":"MDT","Name":"Medtronic plc","Sector":"Health Care"},{"Symbol":"MRK","Name":"Merck & Co.","Sector":"Health Care"},{"Symbol":"MET","Name":"MetLife Inc.","Sector":"Financials"},{"Symbol":"KORS","Name":"Michael Kors Holdings","Sector":"Consumer Discretionary"},{"Symbol":"MCHP","Name":"Microchip Technology","Sector":"Information Technology"},{"Symbol":"MU","Name":"Micron Technology","Sector":"Information Technology"},{"Symbol":"MSFT","Name":"Microsoft Corp.","Sector":"Information Technology"},{"Symbol":"MHK","Name":"Mohawk Industries","Sector":"Consumer Discretionary"},{"Symbol":"TAP","Name":"Molson Coors Brewing Company","Sector":"Consumer Staples"},{"Symbol":"MDLZ","Name":"Mondelez International","Sector":"Consumer Staples"},{"Symbol":"MON","Name":"Monsanto Co.","Sector":"Materials"},{"Symbol":"MNST","Name":"Monster Beverage","Sector":"Consumer Staples"},{"Symbol":"MCO","Name":"Moody's Corp","Sector":"Financials"},{"Symbol":"MS","Name":"Morgan Stanley","Sector":"Financials"},{"Symbol":"MSI","Name":"Motorola Solutions Inc.","Sector":"Information Technology"},{"Symbol":"MUR","Name":"Murphy Oil","Sector":"Energy"},{"Symbol":"MYL","Name":"Mylan N.V.","Sector":"Health Care"},{"Symbol":"NDAQ","Name":"NASDAQ OMX Group","Sector":"Financials"},{"Symbol":"NOV","Name":"National Oilwell Varco Inc.","Sector":"Energy"},{"Symbol":"NAVI","Name":"Navient","Sector":"Financials"},{"Symbol":"NTAP","Name":"NetApp","Sector":"Information Technology"},{"Symbol":"NFLX","Name":"Netflix Inc.","Sector":"Information Technology"},{"Symbol":"NWL","Name":"Newell Rubbermaid Co.","Sector":"Consumer Discretionary"},{"Symbol":"NFX","Name":"Newfield Exploration Co","Sector":"Energy"},{"Symbol":"NEM","Name":"Newmont Mining Corp. (Hldg. Co.)","Sector":"Materials"},{"Symbol":"NWSA","Name":"News Corp. Class A","Sector":"Consumer Discretionary"},{"Symbol":"NWS","Name":"News Corp. Class B","Sector":"Consumer Discretionary"},{"Symbol":"NEE","Name":"NextEra Energy","Sector":"Utilities"},{"Symbol":"NLSN","Name":"Nielsen Holdings","Sector":"Industrials"},{"Symbol":"NKE","Name":"Nike","Sector":"Consumer Discretionary"},{"Symbol":"NI","Name":"NiSource Inc.","Sector":"Utilities"},{"Symbol":"NBL","Name":"Noble Energy Inc","Sector":"Energy"},{"Symbol":"JWN","Name":"Nordstrom","Sector":"Consumer Discretionary"},{"Symbol":"NSC","Name":"Norfolk Southern Corp.","Sector":"Industrials"},{"Symbol":"NTRS","Name":"Northern Trust Corp.","Sector":"Financials"},{"Symbol":"NOC","Name":"Northrop Grumman Corp.","Sector":"Industrials"},{"Symbol":"NRG","Name":"NRG Energy","Sector":"Utilities"},{"Symbol":"NUE","Name":"Nucor Corp.","Sector":"Materials"},{"Symbol":"NVDA","Name":"Nvidia Corporation","Sector":"Information Technology"},{"Symbol":"ORLY","Name":"O'Reilly Automotive","Sector":"Consumer Discretionary"},{"Symbol":"OXY","Name":"Occidental Petroleum","Sector":"Energy"},{"Symbol":"OMC","Name":"Omnicom Group","Sector":"Consumer Discretionary"},{"Symbol":"OKE","Name":"ONEOK","Sector":"Energy"},{"Symbol":"ORCL","Name":"Oracle Corp.","Sector":"Information Technology"},{"Symbol":"OI","Name":"Owens-Illinois Inc","Sector":"Materials"},{"Symbol":"PCAR","Name":"PACCAR Inc.","Sector":"Industrials"},{"Symbol":"PH","Name":"Parker-Hannifin","Sector":"Industrials"},{"Symbol":"PDCO","Name":"Patterson Companies","Sector":"Health Care"},{"Symbol":"PAYX","Name":"Paychex Inc.","Sector":"Information Technology"},{"Symbol":"PYPL","Name":"PayPal","Sector":"Information Technology"},{"Symbol":"PNR","Name":"Pentair Ltd.","Sector":"Industrials"},{"Symbol":"PBCT","Name":"People's United Financial","Sector":"Financials"},{"Symbol":"PEP","Name":"PepsiCo Inc.","Sector":"Consumer Staples"},{"Symbol":"PKI","Name":"PerkinElmer","Sector":"Health Care"},{"Symbol":"PRGO","Name":"Perrigo","Sector":"Health Care"},{"Symbol":"PFE","Name":"Pfizer Inc.","Sector":"Health Care"},{"Symbol":"PCG","Name":"PG&E Corp.","Sector":"Utilities"},{"Symbol":"PM","Name":"Philip Morris International","Sector":"Consumer Staples"},{"Symbol":"PSX","Name":"Phillips 66","Sector":"Energy"},{"Symbol":"PNW","Name":"Pinnacle West Capital","Sector":"Utilities"},{"Symbol":"PXD","Name":"Pioneer Natural Resources","Sector":"Energy"},{"Symbol":"PBI","Name":"Pitney-Bowes","Sector":"Industrials"},{"Symbol":"PNC","Name":"PNC Financial Services","Sector":"Financials"},{"Symbol":"RL","Name":"Polo Ralph Lauren Corp.","Sector":"Consumer Discretionary"},{"Symbol":"PPG","Name":"PPG Industries","Sector":"Materials"},{"Symbol":"PPL","Name":"PPL Corp.","Sector":"Utilities"},{"Symbol":"PX","Name":"Praxair Inc.","Sector":"Materials"},{"Symbol":"PCLN","Name":"Priceline.com Inc","Sector":"Consumer Discretionary"},{"Symbol":"PFG","Name":"Principal Financial Group","Sector":"Financials"},{"Symbol":"PG","Name":"Procter & Gamble","Sector":"Consumer Staples"},{"Symbol":"PGR","Name":"Progressive Corp.","Sector":"Financials"},{"Symbol":"PLD","Name":"Prologis","Sector":"Financials"},{"Symbol":"PRU","Name":"Prudential Financial","Sector":"Financials"},{"Symbol":"PEG","Name":"Public Serv. Enterprise Inc.","Sector":"Utilities"},{"Symbol":"PSA","Name":"Public Storage","Sector":"Financials"},{"Symbol":"PHM","Name":"Pulte Homes Inc.","Sector":"Consumer Discretionary"},{"Symbol":"PVH","Name":"PVH Corp.","Sector":"Consumer Discretionary"},{"Symbol":"QRVO","Name":"Qorvo","Sector":"Information Technology"},{"Symbol":"QCOM","Name":"QUALCOMM Inc.","Sector":"Information Technology"},{"Symbol":"PWR","Name":"Quanta Services Inc.","Sector":"Industrials"},{"Symbol":"DGX","Name":"Quest Diagnostics","Sector":"Health Care"},{"Symbol":"RRC","Name":"Range Resources Corp.","Sector":"Energy"},{"Symbol":"RTN","Name":"Raytheon Co.","Sector":"Industrials"},{"Symbol":"O","Name":"Realty Income Corporation","Sector":"Financials"},{"Symbol":"RHT","Name":"Red Hat Inc.","Sector":"Information Technology"},{"Symbol":"REGN","Name":"Regeneron","Sector":"Health Care"},{"Symbol":"RF","Name":"Regions Financial Corp.","Sector":"Financials"},{"Symbol":"RSG","Name":"Republic Services Inc","Sector":"Industrials"},{"Symbol":"RAI","Name":"Reynolds American Inc.","Sector":"Consumer Staples"},{"Symbol":"RHI","Name":"Robert Half International","Sector":"Industrials"},{"Symbol":"ROK","Name":"Rockwell Automation Inc.","Sector":"Industrials"},{"Symbol":"COL","Name":"Rockwell Collins","Sector":"Industrials"},{"Symbol":"ROP","Name":"Roper Industries","Sector":"Industrials"},{"Symbol":"ROST","Name":"Ross Stores","Sector":"Consumer Discretionary"},{"Symbol":"RCL","Name":"Royal Caribbean Cruises Ltd","Sector":"Consumer Discretionary"},{"Symbol":"R","Name":"Ryder System","Sector":"Industrials"},{"Symbol":"SPGI","Name":"S&P Global, Inc.","Sector":"Financials"},{"Symbol":"CRM","Name":"Salesforce.com","Sector":"Information Technology"},{"Symbol":"SCG","Name":"SCANA Corp","Sector":"Utilities"},{"Symbol":"SLB","Name":"Schlumberger Ltd.","Sector":"Energy"},{"Symbol":"SNI","Name":"Scripps Networks Interactive Inc.","Sector":"Consumer Discretionary"},{"Symbol":"STX","Name":"Seagate Technology","Sector":"Information Technology"},{"Symbol":"SEE","Name":"Sealed Air Corp.(New)","Sector":"Materials"},{"Symbol":"SRE","Name":"Sempra Energy","Sector":"Utilities"},{"Symbol":"SHW","Name":"Sherwin-Williams","Sector":"Materials"},{"Symbol":"SIG","Name":"Signet Jewelers","Sector":"Consumer Discretionary"},{"Symbol":"SPG","Name":"Simon Property Group Inc","Sector":"Financials"},{"Symbol":"SWKS","Name":"Skyworks Solutions","Sector":"Information Technology"},{"Symbol":"SLG","Name":"SL Green Realty","Sector":"Financials"},{"Symbol":"SJM","Name":"Smucker (J.M.)","Sector":"Consumer Staples"},{"Symbol":"SNA","Name":"Snap-On Inc.","Sector":"Consumer Discretionary"},{"Symbol":"SO","Name":"Southern Co.","Sector":"Utilities"},{"Symbol":"LUV","Name":"Southwest Airlines","Sector":"Industrials"},{"Symbol":"SWN","Name":"Southwestern Energy","Sector":"Energy"},{"Symbol":"SE","Name":"Spectra Energy Corp.","Sector":"Energy"},{"Symbol":"STJ","Name":"St Jude Medical","Sector":"Health Care"},{"Symbol":"SWK","Name":"Stanley Black & Decker","Sector":"Consumer Discretionary"},{"Symbol":"SPLS","Name":"Staples Inc.","Sector":"Consumer Discretionary"},{"Symbol":"SBUX","Name":"Starbucks Corp.","Sector":"Consumer Discretionary"},{"Symbol":"HOT","Name":"Starwood Hotels & Resorts","Sector":"Consumer Discretionary"},{"Symbol":"STT","Name":"State Street Corp.","Sector":"Financials"},{"Symbol":"SRCL","Name":"Stericycle Inc","Sector":"Industrials"},{"Symbol":"SYK","Name":"Stryker Corp.","Sector":"Health Care"},{"Symbol":"STI","Name":"SunTrust Banks","Sector":"Financials"},{"Symbol":"SYMC","Name":"Symantec Corp.","Sector":"Information Technology"},{"Symbol":"SYF","Name":"Synchrony Financial","Sector":"Financials"},{"Symbol":"SYY","Name":"Sysco Corp.","Sector":"Consumer Staples"},{"Symbol":"TROW","Name":"T. Rowe Price Group","Sector":"Financials"},{"Symbol":"TGT","Name":"Target Corp.","Sector":"Consumer Discretionary"},{"Symbol":"TEL","Name":"TE Connectivity Ltd.","Sector":"Information Technology"},{"Symbol":"TGNA","Name":"Tegna","Sector":"Consumer Discretionary"},{"Symbol":"TDC","Name":"Teradata Corp.","Sector":"Information Technology"},{"Symbol":"TSO","Name":"Tesoro Petroleum Co.","Sector":"Energy"},{"Symbol":"TXN","Name":"Texas Instruments","Sector":"Information Technology"},{"Symbol":"TXT","Name":"Textron Inc.","Sector":"Industrials"},{"Symbol":"BK","Name":"The Bank of New York Mellon Corp.","Sector":"Financials"},{"Symbol":"CLX","Name":"The Clorox Company","Sector":"Consumer Staples"},{"Symbol":"KO","Name":"The Coca Cola Company","Sector":"Consumer Staples"},{"Symbol":"HSY","Name":"The Hershey Company","Sector":"Consumer Staples"},{"Symbol":"MOS","Name":"The Mosaic Company","Sector":"Materials"},{"Symbol":"TRV","Name":"The Travelers Companies Inc.","Sector":"Financials"},{"Symbol":"DIS","Name":"The Walt Disney Company","Sector":"Consumer Discretionary"},{"Symbol":"TMO","Name":"Thermo Fisher Scientific","Sector":"Health Care"},{"Symbol":"TIF","Name":"Tiffany & Co.","Sector":"Consumer Discretionary"},{"Symbol":"TWX","Name":"Time Warner Inc.","Sector":"Consumer Discretionary"},{"Symbol":"TJX","Name":"TJX Companies Inc.","Sector":"Consumer Discretionary"},{"Symbol":"TMK","Name":"Torchmark Corp.","Sector":"Financials"},{"Symbol":"TSS","Name":"Total System Services","Sector":"Information Technology"},{"Symbol":"TSCO","Name":"Tractor Supply Company","Sector":"Consumer Discretionary"},{"Symbol":"TDG","Name":"TransDigm Group","Sector":"Industrials"},{"Symbol":"RIG","Name":"Transocean","Sector":"Energy"},{"Symbol":"TRIP","Name":"TripAdvisor","Sector":"Consumer Discretionary"},{"Symbol":"FOXA","Name":"Twenty-First Century Fox Class A","Sector":"Consumer Discretionary"},{"Symbol":"FOX","Name":"Twenty-First Century Fox Class B","Sector":"Consumer Discretionary"},{"Symbol":"TYC","Name":"Tyco International","Sector":"Industrials"},{"Symbol":"TSN","Name":"Tyson Foods","Sector":"Consumer Staples"},{"Symbol":"USB","Name":"U.S. Bancorp","Sector":"Financials"},{"Symbol":"UDR","Name":"UDR Inc","Sector":"Financials"},{"Symbol":"ULTA","Name":"Ulta Salon Cosmetics & Fragrance Inc","Sector":"Consumer Discretionary"},{"Symbol":"UA","Name":"Under Armour","Sector":"Consumer Discretionary"},{"Symbol":"UNP","Name":"Union Pacific","Sector":"Industrials"},{"Symbol":"UAL","Name":"United Continental Holdings","Sector":"Industrials"},{"Symbol":"UNH","Name":"United Health Group Inc.","Sector":"Health Care"},{"Symbol":"UPS","Name":"United Parcel Service","Sector":"Industrials"},{"Symbol":"URI","Name":"United Rentals, Inc.","Sector":"Industrials"},{"Symbol":"UTX","Name":"United Technologies","Sector":"Industrials"},{"Symbol":"UHS","Name":"Universal Health Services, Inc.","Sector":"Health Care"},{"Symbol":"UNM","Name":"Unum Group","Sector":"Financials"},{"Symbol":"URBN","Name":"Urban Outfitters","Sector":"Consumer Discretionary"},{"Symbol":"VFC","Name":"V.F. Corp.","Sector":"Consumer Discretionary"},{"Symbol":"VLO","Name":"Valero Energy","Sector":"Energy"},{"Symbol":"VAR","Name":"Varian Medical Systems","Sector":"Health Care"},{"Symbol":"VTR","Name":"Ventas Inc","Sector":"Financials"},{"Symbol":"VRSN","Name":"Verisign Inc.","Sector":"Information Technology"},{"Symbol":"VRSK","Name":"Verisk Analytics","Sector":"Industrials"},{"Symbol":"VZ","Name":"Verizon Communications","Sector":"Telecommunications Services"},{"Symbol":"VRTX","Name":"Vertex Pharmaceuticals Inc","Sector":"Health Care"},{"Symbol":"VIAB","Name":"Viacom Inc.","Sector":"Consumer Discretionary"},{"Symbol":"V","Name":"Visa Inc.","Sector":"Information Technology"},{"Symbol":"VNO","Name":"Vornado Realty Trust","Sector":"Financials"},{"Symbol":"VMC","Name":"Vulcan Materials","Sector":"Materials"},{"Symbol":"WMT","Name":"Wal-Mart Stores","Sector":"Consumer Staples"},{"Symbol":"WBA","Name":"Walgreens Boots Alliance","Sector":"Consumer Staples"},{"Symbol":"WM","Name":"Waste Management Inc.","Sector":"Industrials"},{"Symbol":"WAT","Name":"Waters Corporation","Sector":"Health Care"},{"Symbol":"WFC","Name":"Wells Fargo","Sector":"Financials"},{"Symbol":"HCN","Name":"Welltower Inc.","Sector":"Financials"},{"Symbol":"WDC","Name":"Western Digital","Sector":"Information Technology"},{"Symbol":"WU","Name":"Western Union Co","Sector":"Information Technology"},{"Symbol":"WRK","Name":"Westrock Co","Sector":"Materials"},{"Symbol":"WY","Name":"Weyerhaeuser Corp.","Sector":"Financials"},{"Symbol":"WHR","Name":"Whirlpool Corp.","Sector":"Consumer Discretionary"},{"Symbol":"WFM","Name":"Whole Foods Market","Sector":"Consumer Staples"},{"Symbol":"WMB","Name":"Williams Cos.","Sector":"Energy"},{"Symbol":"WLTW","Name":"Willis Towers Watson","Sector":"Financials"},{"Symbol":"WEC","Name":"Wisconsin Energy Corporation","Sector":"Utilities"},{"Symbol":"WYN","Name":"Wyndham Worldwide","Sector":"Consumer Discretionary"},{"Symbol":"WYNN","Name":"Wynn Resorts Ltd","Sector":"Consumer Discretionary"},{"Symbol":"XEL","Name":"Xcel Energy Inc","Sector":"Utilities"},{"Symbol":"XRX","Name":"Xerox Corp.","Sector":"Information Technology"},{"Symbol":"XLNX","Name":"Xilinx Inc","Sector":"Information Technology"},{"Symbol":"XL","Name":"XL Capital","Sector":"Financials"},{"Symbol":"XYL","Name":"Xylem Inc.","Sector":"Industrials"},{"Symbol":"YHOO","Name":"Yahoo Inc.","Sector":"Information Technology"},{"Symbol":"YUM","Name":"Yum! Brands Inc","Sector":"Consumer Discretionary"},{"Symbol":"ZBH","Name":"Zimmer Biomet Holdings","Sector":"Health Care"},{"Symbol":"ZION","Name":"Zions Bancorp","Sector":"Financials"},{"Symbol":"ZTS","Name":"Zoetis","Sector":"Health Care"}]
			let promise = $timeout();

			angular.forEach(tickerArr, function (tickerObj) {
				promise = promise.then(function() {
			    
					console.log(tickerObj.Symbol);
					var ticker = tickerObj.Symbol;
					var urlc = 'https://services.last10k.com/v1/company/' + ticker + '/quote'
					$http.get(urlc)			
						.then(function(data){
							//console.log("quote", data);
							$scope.quote = data.data;
							$scope.quote.priceToBook = $scope.quote.LastTradePrice/$scope.quote.BookValue;
							//$scope.previousLookups.push({"company" : $scope.quote.Name, "score" : $scope.points});
							$http({
								url: '/stock/quote/' + ticker, 
								data: {"quote": $scope.quote},
								method: "POST",
								headers: {
									'Content-Type': 'application/json'
								}});
						}, function(data){
							alert('Error calling stock data API.');
						});

					var urlr = 'https://services.last10k.com/v1/company/' + ticker + '/ratios'
					$http.get(urlr)			
						.then(function (data) {
							//console.debug("ratios", data);
							var ratios = $scope.setRatioData(data);
							$scope.saveRatioData(ticker, ratios);

						}, function(data){
							alert('Error calling stock data API.');
						});
					return $timeout(2000);
				});
			});
		}


		$scope.saveRatioData = function (ticker, ratios) {
			$http({
				url: '/stock/ratio/' + ticker, 
				data: {"ratios": ratios},
				method: "POST",
				headers: {
					'Content-Type': 'application/json'
				}});
		}

		$scope.setRatioData = function(data) {
			$scope.ratios.currentRatio = data.data.CurrentRatio.Recent["Latest Qtr"];
			$scope.ratios.dividend = data.data.Dividends.Recent.TTM;
			$scope.ratios.quick = data.data.QuickRatio.Recent["Latest Qtr"];
			$scope.ratios.revenue = data.data.Revenue.Recent.TTM;

			var workingCapital = data.data.WorkingCapital.Historical[Object.keys(data.data.WorkingCapital.Historical)[Object.keys(data.data.WorkingCapital.Historical).length - 1]];

			var longTermDebt = data.data.LongTermDebt.Recent["Latest Qtr"];
			var currentAssets = data.data.TotalCurrentAssets.Recent["Latest Qtr"];
			var currentLiabilities = data.data.TotalCurrentLiabilities.Recent["Latest Qtr"];
			$scope.ratios.longTermDebtCoverageRatio = (currentAssets-currentLiabilities)/longTermDebt;

			

			var ntarr = $.map(data.data.NetIncome.Historical, function(value, index) {
			    return [value];
			});
			//net income eldest 3 years
			var ntfirst3avg = (ntarr[0] + ntarr[1] + ntarr[2]) / 3;
			//net income newest 3 years
			var ntlast3avg = (ntarr[7] + ntarr[8] + ntarr[9]) / 3;
			//console.log(ntfirst3avg, ntlast3avg);
			var ntrevavg = (Math.pow(ntlast3avg/ntfirst3avg, 0.1) - 1) * 100;
			//console.log(ntrevavg); 
			$scope.ratios.revenuetenyr = ntrevavg;

			//divide old/new -1 * 100
			//$scope.ratios.revenuetenyr = data.data.RevenueTenYearAverage.Historical[Object.keys(data.data.RevenueTenYearAverage.Historical)[Object.keys(data.data.RevenueTenYearAverage.Historical).length - 1]];

			var divTot = 0;
			angular.forEach(data.data.Dividends.Historical, function(key, value) {
				if (key > 0){
					divTot++;
				}
			});
			$scope.ratios.dividendTotal = divTot;

			var netTot = 0;
			angular.forEach(data.data.NetIncome.Historical, function(key, value) {
				if (key > 0){
					netTot++;
				}
			});
			$scope.ratios.netincome = netTot;

			return $scope.ratios;				
		};

		$scope.clearHistory = function () {
			$scope.user.history = [];
			$scope.user.$save();
		}

	});
})();